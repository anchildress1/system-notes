---
alt: "Decision tree explaining why two indices with normalized schemas and opaque data fields"
---
graph TD
    accTitle: Algolia Index Design Rationale
    accDescr: Decision tree showing tradeoffs between single vs multiple indices, normalized vs flattened schemas, and searchable vs opaque data fields
    
    Start["Index design decisions"]:::start
    
    %% Question 1: How many indices?
    Q1{"One index or multiple?"}:::question
    Single["Single index<br/>pros: simple<br/>cons: compromised settings"]:::option
    Multiple["Multiple indices<br/>pros: per-type tuning<br/>cons: more config"]:::option
    
    %% Question 2: Schema structure
    Q2{"Flatten data.* or normalize?"}:::question
    Flatten["Flatten all nested fields<br/>pros: search everything<br/>cons: bloat, noise, 3-5KB/record"]:::option
    Normalize["Top-level only<br/>pros: small (800B-1.5KB), focused<br/>cons: data.* not searchable"]:::option
    
    %% Question 3: Opaque data field
    Q3{"Search data.* or keep opaque?"}:::question
    SearchData["Make data.* searchable<br/>pros: granular queries<br/>cons: relevance dilution"]:::option
    OpaqueData["Opaque data field<br/>pros: clean search surface<br/>cons: retrieve-only"]:::option
    
    %% Final decision
    Decision["CHOSEN DESIGN<br/>2 indices (projects, about)<br/>normalized top-level schema<br/>opaque data field"]:::chosen
    
    %% Rationale
    Why1["WHY: projects needs order_rank,<br/>about needs updated_at<br/>single index can't do both"]:::rationale
    Why2["WHY: 36 records total,<br/>avg 800B-1.5KB each<br/>no need for nested search"]:::rationale
    Why3["WHY: 5-6 searchable attrs enough,<br/>data.* adds 10+ more,<br/>creates ranking noise"]:::rationale
    
    %% Future path
    Future["IF future need: extract to top-level<br/>or create new index<br/>NEVER auto-flatten"]:::future
    
    %% Flow
    Start --> Q1
    Q1 -->|compromise| Single
    Q1 -->|per-type tuning| Multiple
    
    Multiple --> Q2
    Q2 -->|search everything| Flatten
    Q2 -->|focused| Normalize
    
    Normalize --> Q3
    Q3 -->|granular| SearchData
    Q3 -->|clean surface| OpaqueData
    
    OpaqueData --> Decision
    Decision --> Why1
    Decision --> Why2
    Decision --> Why3
    Decision --> Future
    
    %% Styles - theme-agnostic
    classDef start fill:#6b7280,stroke:#4b5563,stroke-width:3px,color:#f9fafb
    classDef question fill:#dc2626,stroke:#b91c1c,stroke-width:2px,color:#fef2f2
    classDef option fill:#d1d5db,stroke:#9ca3af,stroke-width:1px,color:#1f2937
    classDef chosen fill:#059669,stroke:#047857,stroke-width:3px,color:#f0fdf4
    classDef rationale fill:#0891b2,stroke:#0e7490,stroke-width:2px,color:#ecfeff
    classDef future fill:#7c3aed,stroke:#6d28d9,stroke-width:2px,color:#faf5ff
